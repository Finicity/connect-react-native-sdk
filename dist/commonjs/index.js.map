{"version":3,"sources":["index.tsx"],"names":["defaultEventHandlers","onLoad","onUser","event","onRoute","FinicityConnect","Component","constructor","props","connectUrl","pingingConnect","pingedConnectSuccessfully","pingIntervalId","eventHandlers","browserDisplayed","linkingUri","state","onCancel","code","reason","webViewRef","postMessage","type","ConnectEvents","PING","sdkVersion","CONNECT_SDK_VERSION","platform","SDK_PLATFORM","stopPingingConnect","setInterval","pingConnect","PING_TIMEOUT","clearInterval","closed","InAppBrowser","closeAuth","url","isAvailable","openAuth","dismissBrowser","eventData","parseEventData","nativeEvent","data","eventType","URL","openBrowser","CLOSE_POPUP","ACK","CANCEL","DONE","onDone","ERROR","onError","ROUTE","USER","launch","JSON","stringify","render","Platform","OS","close","ref","uri","handleEvent","startPingingConnect","parse","e"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { Modal, Platform } from 'react-native';\nimport { WebView } from 'react-native-webview';\nimport { InAppBrowser } from 'react-native-inappbrowser-reborn';\nimport {\n  ConnectEvents,\n  CONNECT_SDK_VERSION,\n  SDK_PLATFORM,\n  PING_TIMEOUT,\n} from './constants';\n\nexport interface ConnectEventHandlers {\n  onDone: (event: ConnectDoneEvent) => void;\n  onCancel: (event: ConnectCancelEvent) => void;\n  onError: (event: ConnectErrorEvent) => void;\n  onRoute?: (event: ConnectRouteEvent) => void;\n  onUser?: (event: any) => void;\n  onLoad?: () => void;\n}\n\nconst defaultEventHandlers: any = {\n  onLoad: () => {},\n  onUser: (event: any) => {},\n  onRoute: (event: ConnectRouteEvent) => {},\n};\n\nexport interface FinicityConnectProps {\n  connectUrl: string;\n  eventHandlers: ConnectEventHandlers;\n  linkingUri?: string;\n}\n\nexport interface ConnectCancelEvent {\n  code: number;\n  reason: string;\n}\n\nexport interface ConnectErrorEvent {\n  code: number;\n  reason: string;\n}\n\nexport interface ConnectDoneEvent {\n  code: number;\n  reason: string;\n  reportData: [\n    {\n      portfolioId: string;\n      type: string;\n      reportId: string;\n    }\n  ];\n}\n\nexport interface ConnectRouteEvent {\n  screen: string;\n  params: any;\n}\n\nexport class FinicityConnect extends Component<FinicityConnectProps> {\n  webViewRef: WebView | null = null;\n  state = {\n    connectUrl: '',\n    pingingConnect: false,\n    pingedConnectSuccessfully: false,\n    pingIntervalId: 0,\n    eventHandlers: defaultEventHandlers,\n    browserDisplayed: false,\n    linkingUri: '',\n  };\n\n  constructor(props: FinicityConnectProps) {\n    super(props);\n    this.launch(props.connectUrl, props.eventHandlers, props.linkingUri);\n  }\n\n  launch = (\n    connectUrl: string,\n    eventHandlers: ConnectEventHandlers,\n    linkingUri = ''\n  ) => {\n    this.state.connectUrl = connectUrl;\n    this.state.eventHandlers = { ...defaultEventHandlers, ...eventHandlers };\n    this.state.linkingUri = linkingUri;\n  };\n\n  close = () => {\n    this.state.eventHandlers.onCancel({\n      code: 100,\n      reason: 'exit',\n    });\n  };\n\n  postMessage(eventData: any) {\n    this.webViewRef?.postMessage(JSON.stringify(eventData));\n  }\n\n  pingConnect = () => {\n    if (this.webViewRef !== null) {\n      this.postMessage({\n        type: ConnectEvents.PING,\n        sdkVersion: CONNECT_SDK_VERSION,\n        platform: SDK_PLATFORM,\n      });\n    } else {\n      this.stopPingingConnect();\n    }\n  };\n\n  startPingingConnect = () => {\n    if (\n      this.webViewRef !== null &&\n      !this.state.pingedConnectSuccessfully &&\n      !this.state.pingingConnect &&\n      this.state.pingIntervalId === 0\n    ) {\n      this.state.pingingConnect = true;\n      (this.state.pingIntervalId as any) = setInterval(\n        this.pingConnect,\n        PING_TIMEOUT\n      );\n    }\n  };\n\n  stopPingingConnect = () => {\n    if (this.state.pingingConnect && this.state.pingIntervalId != 0) {\n      clearInterval(this.state.pingIntervalId);\n      this.state.pingingConnect = false;\n      this.state.pingIntervalId = 0;\n    }\n  };\n\n  dismissBrowser = () => {\n    if (this.state.browserDisplayed) {\n      this.postMessage({ type: 'window', closed: true });\n      this.state.browserDisplayed = false;\n      InAppBrowser.closeAuth();\n    }\n  };\n\n  openBrowser = async (url: string) => {\n    this.state.browserDisplayed = true;\n    await InAppBrowser.isAvailable();\n    await InAppBrowser.openAuth(url, this.state.linkingUri);\n    this.dismissBrowser();\n  };\n\n  handleEvent = (event: any) => {\n    const eventData = parseEventData(event.nativeEvent.data);\n    const eventType = eventData.type;\n    if (eventType === ConnectEvents.URL && !this.state.browserDisplayed) {\n      const url = eventData.url;\n      this.openBrowser(url);\n    } else if (\n      eventType === ConnectEvents.CLOSE_POPUP &&\n      this.state.browserDisplayed\n    ) {\n      this.dismissBrowser();\n    } else if (eventType === ConnectEvents.ACK) {\n      this.state.pingedConnectSuccessfully = true;\n      this.stopPingingConnect();\n      this.state.eventHandlers.onLoad();\n    } else if (eventType === ConnectEvents.CANCEL) {\n      this.state.eventHandlers.onCancel(eventData.data);\n    } else if (eventType === ConnectEvents.DONE) {\n      this.state.eventHandlers.onDone(eventData.data);\n    } else if (eventType === ConnectEvents.ERROR) {\n      this.state.eventHandlers.onError(eventData.data);\n    } else if (eventType === ConnectEvents.ROUTE) {\n      this.state.eventHandlers.onRoute(eventData.data);\n    } else if (eventType === ConnectEvents.USER) {\n      this.state.eventHandlers.onUser(eventData.data);\n    }\n  };\n\n  render() {\n    return (\n      <Modal\n        animationType={'slide'}\n        presentationStyle={Platform.OS === 'ios' ? 'pageSheet' : 'fullScreen'}\n        transparent={false}\n        onRequestClose={() => this.close()}\n      >\n        <WebView\n          ref={(ref: any) => (this.webViewRef = ref)}\n          source={{ uri: this.state.connectUrl }}\n          onMessage={(event) => this.handleEvent(event)}\n          onLoad={() => this.startPingingConnect()}\n        />\n      </Modal>\n    );\n  }\n}\n\nfunction parseEventData(eventData: any) {\n  try {\n    return typeof eventData === 'string' ? JSON.parse(eventData) : eventData;\n  } catch (e) {\n    return {};\n  }\n}\n"]}